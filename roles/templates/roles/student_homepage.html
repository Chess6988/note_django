{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
    
    <div class="row min-vh-100">
        <!-- Sidebar Toggle Button (visible on mobile) -->
        <button class="btn btn-primary d-md-none m-2" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            ‚ò∞ Menu
        </button>

      <aside id="sidebarMenu" class="collapse d-md-flex col-12 col-md-3 col-lg-2 bg-primary text-white flex-column p-3 shadow-sm" style="border-radius: 0 8px 8px 0;">
    <nav class="nav nav-pills flex-column gap-1">

        <a href="{% url 'roles:student_homepage' %}" class="nav-link text-white d-flex align-items-center px-3 py-2 rounded"
           style="transition: background 0.3s ease, transform 0.2s ease; font-weight: 500; letter-spacing: 0.03em;"
           onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateX(2px)'; this.style.textShadow='0 1px 1px rgba(0,0,0,0.2)'"
           onmouseout="this.style.background=''; this.style.transform=''; this.style.textShadow=''">
            <i class="bi bi-speedometer2 me-2 fs-5"
               style="transition: transform 0.2s ease;"
               onmouseover="this.style.transform='scale(1.1)'"
               onmouseout="this.style.transform=''">
            </i>
            <span>Tableau de Bord</span>
        </a>

        <a href="{% url 'roles:etudiant_dashboard' %}" class="nav-link text-white d-flex align-items-center px-3 py-2 rounded"
           style="transition: background 0.3s ease, transform 0.2s ease; font-weight: 500; letter-spacing: 0.03em;"
           onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateX(2px)'; this.style.textShadow='0 1px 1px rgba(0,0,0,0.2)'"
           onmouseout="this.style.background=''; this.style.transform=''; this.style.textShadow=''">
            <i class="bi bi-person-circle me-2 fs-5"
               style="transition: transform 0.2s ease;"
               onmouseover="this.style.transform='scale(1.1)'"
               onmouseout="this.style.transform=''">
            </i>
            <span>Profil</span>
        </a>

        <a href="{% url 'roles:logout' %}" class="nav-link text-white d-flex align-items-center px-3 py-2 rounded"
           style="transition: background 0.3s ease, transform 0.2s ease; font-weight: 500; letter-spacing: 0.03em;"
           onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateX(2px)'; this.style.textShadow='0 1px 1px rgba(0,0,0,0.2)'"
           onmouseout="this.style.background=''; this.style.transform=''; this.style.textShadow=''">
            <i class="bi bi-box-arrow-right me-2 fs-5"
               style="transition: transform 0.2s ease;"
               onmouseover="this.style.transform='scale(1.1)'"
               onmouseout="this.style.transform=''">
            </i>
            <span>D√©connexion</span>
        </a>

    </nav>
</aside>

</aside>


        <!-- Main Content Area -->
        <main class="col-md-9 col-lg-10 py-4">
                    </section>

        <style>
   
        
       
.container-fluid > .row {
    margin-left: 0 !important;
    margin-right: 0 !important;
}

#sidebarMenu {
    padding-left: 0 !important;
    padding-right: 0 !important;
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
}

/* Enhanced main area contrast */
main.col-md-9.col-lg-10 {
    flex: 1 1 auto;
    width: 100% !important;
    margin-left: 0 !important;
    padding-left: 2rem !important;
    padding-right: 2rem !important;
    background-color: #f8f9fa; /* light gray background */
}
</style>

        </style>

            <!-- Success Modal -->
            <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="successModalLabel">Succ√®s</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Informations enregistr√©es avec succ√®s.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Fermer</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Welcome Section -->
            <section class="mb-4">
                <h1 class="h3 text-primary fw-semibold text-capitalize">Bienvenue, {{ student.user.username|title }}üëã </h1>
                <p class="text-muted">Institut Management et Entrepreneuriat, Yaound√© - Ann√©e Acad√©mique {{ current_year }}</p>
            </section>

            <!-- Profile Section -->
            <section class="mb-4 card p-4 border-0 shadow-sm rounded-4 bg-white" style="box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);">
  <!-- Section Header -->
  <div class="d-flex align-items-center mb-4">
    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
      <i class="bi bi-person-vcard fs-4"></i>
    </div>
    <h2 class="h4 fw-bold mb-0 text-primary">Profil Acad√©mique</h2>
  </div>

  {% if student.profileetudiant_set.last %}
  <!-- Profile Content -->
  <div class="row gy-4">
    <div class="col-md-6">
      <div class="d-flex align-items-start gap-3">
        <i class="bi bi-person-circle text-muted fs-5"></i>
        <div>
          <div class="text-muted small">Nom</div>
          <div class="fw-semibold text-capitalize">{{ student.user.username|title }}</div>
        </div>
      </div>
      <div class="d-flex align-items-start gap-3 mt-4">
        <i class="bi bi-journal-text text-muted fs-5"></i>
        <div>
          <div class="text-muted small">Fili√®re</div>
          <div class="fw-semibold">{{ student.profileetudiant_set.last.filiere.nom_filiere }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="d-flex align-items-start gap-3">
        <i class="bi bi-bar-chart-line text-muted fs-5"></i>
        <div>
          <div class="text-muted small">Niveau</div>
          <div class="fw-semibold">{{ student.profileetudiant_set.last.niveau.nom_niveau }}</div>
        </div>
      </div>
      <div class="d-flex align-items-start gap-3 mt-4">
        <i class="bi bi-calendar-event text-muted fs-5"></i>
        <div>
          <div class="text-muted small">Semestre</div>
          <div class="fw-semibold">{{ student.profileetudiant_set.last.semestre.nom_semestre }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Academic Year -->
  <div class="d-flex align-items-start gap-3 mt-4">
    <i class="bi bi-clock-history text-muted fs-5"></i>
    <div>
      <div class="text-muted small">Ann√©e Acad√©mique</div>
      <div class="fw-semibold">{{ current_year }}</div>
    </div>
  </div>

  <!-- Action Button -->
  <div class="mt-5">
    <a href="{% url 'roles:etudiant_dashboard' %}" class="btn btn-primary d-inline-flex align-items-center gap-2 px-4 py-2 rounded-pill">
      <i class="bi bi-pencil-fill"></i>
      Modifier le Profil
    </a>
  </div>
  {% else %}
  <!-- Empty State -->
  <div class="text-center text-muted py-5">
    <i class="bi bi-person-x fs-1 text-secondary mb-3"></i>
    <p class="mb-3">Votre profil acad√©mique n'est pas encore cr√©√©.</p>
    <a href="{% url 'roles:etudiant_dashboard' %}" class="btn btn-outline-primary d-inline-flex align-items-center gap-2 rounded-pill">
      <i class="bi bi-plus-circle"></i>
      Cr√©er mon profil
    </a>
  </div>
  {% endif %}
</section>
            <!-- Subjects Table -->
           <section class="mb-4 card p-4 border-0 shadow-sm rounded-3" style="box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);">
    
    <h2 class="h4 fw-semibold text-primary mb-3 d-flex align-items-center gap-2">
        <i class="bi bi-journal-bookmark-fill text-primary fs-5"></i> Mati√®res Inscrites
    </h2>

    
<div class="table-responsive">
    <table class="table table-hover table-striped align-middle border border-light-subtle rounded-2 overflow-hidden">
       <thead class="bg-primary text-white fw-semibold">
    <tr>
        <th class="px-3 py-3">
            <i class="bi bi-hash me-1"></i>Code
        </th>
        <th class="px-3 py-3">
            <i class="bi bi-journal-bookmark me-1"></i>Mati√®re
        </th>
        <th class="px-3 py-3">
            <i class="bi bi-tags me-1"></i>Type
        </th>
        <th class="px-3 py-3">
            <i class="bi bi-calendar2-week me-1"></i>Semestre
        </th>
        <th class="px-3 py-3">
            <i class="bi bi-mortarboard me-1"></i>Niveau
        </th>
        <th class="px-3 py-3 text-center">
            <i class="bi bi-clipboard-check me-1"></i>Notes
        </th>
    </tr>
</thead>

        <tbody>
            {% if student.matiereetudiant_set.all or student.matierecommuneetudiant_set.all %}
                {% for matiere in student.matiereetudiant_set.all %}
                <tr>
                    <td class="px-3 py-3">{{ matiere.matiere.course_code }}</td>
                    <td class="px-3 py-3">{{ matiere.matiere.nom_matiere }}</td>
                    <td class="px-3 py-3">
                        <span class="badge rounded-pill bg-info text-dark">
                            <i class="bi bi-person-badge me-1"></i> Sp√©cifique
                        </span>
                    </td>
                    <td class="px-3 py-3">{{ matiere.matiere.semestre.nom_semestre }}</td>
                    <td class="px-3 py-3">{{ matiere.matiere.niveau.nom_niveau }}</td>
                    <td class="px-3 py-3 text-center text-muted">
                        √Ä venir <i class="bi bi-clock-history ms-1 text-muted" title="Notes √† venir"></i>
                    </td>
                </tr>
                {% endfor %}
                {% for matiere_commune in student.matierecommuneetudiant_set.all %}
                <tr>
                    <td class="px-3 py-3">{{ matiere_commune.matiere_commune.course_code }}</td>
                    <td class="px-3 py-3">{{ matiere_commune.matiere_commune.nom_matiere_commune }}</td>
                    <td class="px-3 py-3">
                        <span class="badge rounded-pill bg-secondary text-dark">
                            <i class="bi bi-people me-1"></i> Commun
                        </span>
                    </td>
                    <td class="px-3 py-3">{{ matiere_commune.matiere_commune.semestre.nom_semestre }}</td>
                    <td class="px-3 py-3">{{ matiere_commune.matiere_commune.niveau.nom_niveau }}</td>
                    <td class="px-3 py-3 text-center text-muted">
                        √Ä venir <i class="bi bi-clock-history ms-1 text-muted" title="Notes √† venir"></i>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted py-5">
                        <div class="d-flex flex-column align-items-center">
                            <i class="bi bi-inbox fs-1 text-secondary mb-3"></i>
                            <div>Aucune mati√®re inscrite</div>
                            <small class="text-primary mt-1">Cliquez ici pour vous inscrire √† des mati√®res</small>
                        </div>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

</section>



            <!-- Announcements -->
            <section class="card p-3 border-0 shadow-sm">
                <h2 class="h5 text-primary mb-3">Annonces</h2>
                <p class="text-muted">Chargement des annonces...</p>
            </section>

            {% block footer %}
            <footer class="bg-primary text-white py-3 mt-5">
                <div class="container text-center">
                    <p class="mb-0">¬© {{ current_year }} Institut de Management et de l'Entrepreneuriat (IME). Tous droits r√©serv√©s.</p>
                    <p class="mb-0">Contact : info@ime.cm | +237 123 456 789</p>
                </div>
            </footer>
            {% endblock %}
        </main>
    </div>
</div>
{% endblock %}

<script>
// Auto-dismiss Bootstrap alerts after 10 seconds
window.addEventListener('DOMContentLoaded', function() {
    var alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
        setTimeout(function() {
            if (alert.classList.contains('show')) {
                alert.classList.remove('show');
                setTimeout(function() { alert.style.display = 'none'; }, 150);
            } else {
                alert.style.display = 'none';
            }
        }, 10000);
    });
});
</script>
